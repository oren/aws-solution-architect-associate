"use strict";
const construct_1 = require("../../lib/core/construct");
const tag_manager_1 = require("../../lib/core/tag-manager");
class ChildTagger extends construct_1.Construct {
    constructor(parent, name) {
        super(parent, name);
        this.tags = new tag_manager_1.TagManager(parent);
    }
}
class Child extends construct_1.Construct {
    constructor(parent, name) {
        super(parent, name);
    }
}
module.exports = {
    'TagManger handles tags for a Contruct Tree': {
        'setTag by default propagates to children'(test) {
            const root = new construct_1.Root();
            const ctagger = new ChildTagger(root, 'one');
            const ctagger1 = new ChildTagger(ctagger, 'two');
            const ctagger2 = new ChildTagger(root, 'three');
            // not taggable at all
            new Child(ctagger, 'notag');
            const tag = { key: 'Name', value: 'TheCakeIsALie' };
            ctagger.tags.setTag(tag.key, tag.value);
            const tagArray = [tag];
            for (const construct of [ctagger, ctagger1]) {
                test.deepEqual(construct.tags.resolve(), tagArray);
            }
            test.deepEqual(ctagger2.tags.resolve(), undefined);
            test.done();
        },
        'setTag with propagate false tags do not propagate'(test) {
            const root = new construct_1.Root();
            const ctagger = new ChildTagger(root, 'one');
            const ctagger1 = new ChildTagger(ctagger, 'two');
            const ctagger2 = new ChildTagger(root, 'three');
            // not taggable at all
            new Child(ctagger, 'notag');
            const tag = { key: 'Name', value: 'TheCakeIsALie' };
            ctagger.tags.setTag(tag.key, tag.value, { propagate: false });
            for (const construct of [ctagger1, ctagger2]) {
                test.deepEqual(construct.tags.resolve(), undefined);
            }
            test.deepEqual(ctagger.tags.resolve()[0].key, 'Name');
            test.deepEqual(ctagger.tags.resolve()[0].value, 'TheCakeIsALie');
            test.done();
        },
        'setTag with overwrite false does not overwrite a tag'(test) {
            const root = new construct_1.Root();
            const ctagger = new ChildTagger(root, 'one');
            ctagger.tags.setTag('Env', 'Dev');
            ctagger.tags.setTag('Env', 'Prod', { overwrite: false });
            const result = ctagger.tags.resolve();
            test.deepEqual(result, [{ key: 'Env', value: 'Dev' }]);
            test.done();
        },
        'setTag with sticky false enables propagations to overwrite child tags'(test) {
            const root = new construct_1.Root();
            const ctagger = new ChildTagger(root, 'one');
            const ctagger1 = new ChildTagger(ctagger, 'two');
            ctagger.tags.setTag('Parent', 'Is always right');
            ctagger1.tags.setTag('Parent', 'Is wrong', { sticky: false });
            const parent = ctagger.tags.resolve();
            const child = ctagger1.tags.resolve();
            test.deepEqual(parent, child);
            test.done();
        },
        'tags propagate from all parents'(test) {
            const root = new construct_1.Root();
            const ctagger = new ChildTagger(root, 'one');
            new ChildTagger(ctagger, 'two');
            const cNoTag = new Child(ctagger, 'three');
            const ctagger2 = new ChildTagger(cNoTag, 'four');
            const tag = { key: 'Name', value: 'TheCakeIsALie' };
            ctagger.tags.setTag(tag.key, tag.value, { propagate: true });
            test.deepEqual(ctagger2.tags.resolve(), [tag]);
            test.done();
        },
        'a tag can be removed and added back'(test) {
            const root = new construct_1.Root();
            const ctagger = new ChildTagger(root, 'one');
            const tag = { key: 'Name', value: 'TheCakeIsALie' };
            ctagger.tags.setTag(tag.key, tag.value, { propagate: true });
            test.deepEqual(ctagger.tags.resolve(), [tag]);
            ctagger.tags.removeTag(tag.key);
            test.deepEqual(ctagger.tags.resolve(), undefined);
            ctagger.tags.setTag(tag.key, tag.value, { propagate: true });
            test.deepEqual(ctagger.tags.resolve(), [tag]);
            test.done();
        },
        'removeTag removes a tag by key'(test) {
            const root = new construct_1.Root();
            const ctagger = new ChildTagger(root, 'one');
            const ctagger1 = new ChildTagger(ctagger, 'two');
            const ctagger2 = new ChildTagger(root, 'three');
            // not taggable at all
            new Child(ctagger, 'notag');
            const tag = { key: 'Name', value: 'TheCakeIsALie' };
            ctagger.tags.setTag(tag.key, tag.value);
            ctagger.tags.removeTag('Name');
            for (const construct of [ctagger, ctagger1, ctagger2]) {
                test.deepEqual(construct.tags.resolve(), undefined);
            }
            test.done();
        },
        'removeTag with blockPropagate removes any propagated tags'(test) {
            const root = new construct_1.Root();
            const ctagger = new ChildTagger(root, 'one');
            const ctagger1 = new ChildTagger(ctagger, 'two');
            ctagger.tags.setTag('Env', 'Dev');
            ctagger1.tags.removeTag('Env', { blockPropagate: true });
            const result = ctagger.tags.resolve();
            test.deepEqual(result, [{ key: 'Env', value: 'Dev' }]);
            test.deepEqual(ctagger1.tags.resolve(), undefined);
            test.done();
        },
        'children can override parent propagated tags'(test) {
            const root = new construct_1.Root();
            const ctagger = new ChildTagger(root, 'one');
            const ctagChild = new ChildTagger(ctagger, 'one');
            const tag = { key: 'BestBeach', value: 'StoneSteps' };
            const tag2 = { key: 'BestBeach', value: 'k-38' };
            ctagger.tags.setTag(tag2.key, tag2.value);
            ctagger.tags.setTag(tag.key, tag.value);
            ctagChild.tags.setTag(tag2.key, tag2.value);
            const parentTags = ctagger.tags.resolve();
            const childTags = ctagChild.tags.resolve();
            test.deepEqual(parentTags, [tag]);
            test.deepEqual(childTags, [tag2]);
            test.done();
        },
        'resolve() returns all tags'(test) {
            const root = new construct_1.Root();
            const ctagger = new ChildTagger(root, 'one');
            const ctagChild = new ChildTagger(ctagger, 'one');
            const tagsNoProp = [
                { key: 'NorthCountySpot', value: 'Tabletops' },
                { key: 'Crowded', value: 'Trestles' },
            ];
            const tagsProp = [
                { key: 'BestBeach', value: 'StoneSteps' },
                { key: 'BestWaves', value: 'Blacks' },
            ];
            for (const tag of tagsNoProp) {
                ctagger.tags.setTag(tag.key, tag.value, { propagate: false });
            }
            for (const tag of tagsProp) {
                ctagger.tags.setTag(tag.key, tag.value);
            }
            const allTags = tagsNoProp.concat(tagsProp);
            const cAll = ctagger.tags;
            const cProp = ctagChild.tags;
            for (const tag of cAll.resolve()) {
                const expectedTag = allTags.filter((t) => (t.key === tag.key));
                test.deepEqual(expectedTag[0].value, tag.value);
            }
            for (const tag of cProp.resolve()) {
                const expectedTag = tagsProp.filter((t) => (t.key === tag.key));
                test.deepEqual(expectedTag[0].value, tag.value);
            }
            test.done();
        },
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC50YWctbWFuYWdlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInRlc3QudGFnLW1hbmFnZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLHdEQUEyRDtBQUMzRCw0REFBbUU7QUFFbkUsTUFBTSxXQUFZLFNBQVEscUJBQVM7SUFFakMsWUFBWSxNQUFpQixFQUFFLElBQVk7UUFDekMsS0FBSyxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNwQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksd0JBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNyQyxDQUFDO0NBQ0Y7QUFFRCxNQUFNLEtBQU0sU0FBUSxxQkFBUztJQUMzQixZQUFZLE1BQWlCLEVBQUUsSUFBWTtRQUN6QyxLQUFLLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3RCLENBQUM7Q0FDRjtBQUVELGlCQUFTO0lBQ1AsNENBQTRDLEVBQUU7UUFDNUMsMENBQTBDLENBQUMsSUFBVTtZQUNuRCxNQUFNLElBQUksR0FBRyxJQUFJLGdCQUFJLEVBQUUsQ0FBQztZQUN4QixNQUFNLE9BQU8sR0FBRyxJQUFJLFdBQVcsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDN0MsTUFBTSxRQUFRLEdBQUcsSUFBSSxXQUFXLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ2pELE1BQU0sUUFBUSxHQUFHLElBQUksV0FBVyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztZQUVoRCxzQkFBc0I7WUFDdEIsSUFBSSxLQUFLLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBRTVCLE1BQU0sR0FBRyxHQUFHLEVBQUMsR0FBRyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsZUFBZSxFQUFDLENBQUM7WUFDbEQsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsS0FBSyxDQUFD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cm9tICdub2RldW5pdCc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QsIFJvb3QgfSBmcm9tICcuLi8uLi9saWIvY29yZS9jb25zdHJ1Y3QnO1xuaW1wb3J0IHsgSVRhZ2dhYmxlLCBUYWdNYW5hZ2VyIH0gZnJvbSAnLi4vLi4vbGliL2NvcmUvdGFnLW1hbmFnZXInO1xuXG5jbGFzcyBDaGlsZFRhZ2dlciBleHRlbmRzIENvbnN0cnVjdCBpbXBsZW1lbnRzIElUYWdnYWJsZSB7XG4gIHB1YmxpYyByZWFkb25seSB0YWdzOiBUYWdNYW5hZ2VyO1xuICBjb25zdHJ1Y3RvcihwYXJlbnQ6IENvbnN0cnVjdCwgbmFtZTogc3RyaW5nKSB7XG4gICAgc3VwZXIocGFyZW50LCBuYW1lKTtcbiAgICB0aGlzLnRhZ3MgPSBuZXcgVGFnTWFuYWdlcihwYXJlbnQpO1xuICB9XG59XG5cbmNsYXNzIENoaWxkIGV4dGVuZHMgQ29uc3RydWN0IHtcbiAgY29uc3RydWN0b3IocGFyZW50OiBDb25zdHJ1Y3QsIG5hbWU6IHN0cmluZykge1xuICAgIHN1cGVyKHBhcmVudCwgbmFtZSk7XG4gIH1cbn1cblxuZXhwb3J0ID0ge1xuICAnVGFnTWFuZ2VyIGhhbmRsZXMgdGFncyBmb3IgYSBDb250cnVjdCBUcmVlJzoge1xuICAgICdzZXRUYWcgYnkgZGVmYXVsdCBwcm9wYWdhdGVzIHRvIGNoaWxkcmVuJyh0ZXN0OiBUZXN0KSB7XG4gICAgICBjb25zdCByb290ID0gbmV3IFJvb3QoKTtcbiAgICAgIGNvbnN0IGN0YWdnZXIgPSBuZXcgQ2hpbGRUYWdnZXIocm9vdCwgJ29uZScpO1xuICAgICAgY29uc3QgY3RhZ2dlcjEgPSBuZXcgQ2hpbGRUYWdnZXIoY3RhZ2dlciwgJ3R3bycpO1xuICAgICAgY29uc3QgY3RhZ2dlcjIgPSBuZXcgQ2hpbGRUYWdnZXIocm9vdCwgJ3RocmVlJyk7XG5cbiAgICAgIC8vIG5vdCB0YWdnYWJsZSBhdCBhbGxcbiAgICAgIG5ldyBDaGlsZChjdGFnZ2VyLCAnbm90YWcnKTtcblxuICAgICAgY29uc3QgdGFnID0ge2tleTogJ05hbWUnLCB2YWx1ZTogJ1RoZUNha2VJc0FMaWUnfTtcbiAgICAgIGN0YWdnZXIudGFncy5zZXRUYWcodGFnLmtleSwgdGFnLnZhbHVlKTtcblxuICAgICAgY29uc3QgdGFnQXJyYXkgPSBbdGFnXTtcbiAgICAgIGZvciAoY29uc3QgY29uc3RydWN0IG9mIFtjdGFnZ2VyLCBjdGFnZ2VyMV0pIHtcbiAgICAgICAgdGVzdC5kZWVwRXF1YWwoY29uc3RydWN0LnRhZ3MucmVzb2x2ZSgpLCB0YWdBcnJheSk7XG4gICAgICB9XG5cbiAgICAgIHRlc3QuZGVlcEVxdWFsKGN0YWdnZXIyLnRhZ3MucmVzb2x2ZSgpLCB1bmRlZmluZWQpO1xuICAgICAgdGVzdC5kb25lKCk7XG4gICAgfSxcbiAgICAnc2V0VGFnIHdpdGggcHJvcGFnYXRlIGZhbHNlIHRhZ3MgZG8gbm90IHByb3BhZ2F0ZScodGVzdDogVGVzdCkge1xuICAgICAgY29uc3Qgcm9vdCA9IG5ldyBSb290KCk7XG4gICAgICBjb25zdCBjdGFnZ2VyID0gbmV3IENoaWxkVGFnZ2VyKHJvb3QsICdvbmUnKTtcbiAgICAgIGNvbnN0IGN0YWdnZXIxID0gbmV3IENoaWxkVGFnZ2VyKGN0YWdnZXIsICd0d28nKTtcbiAgICAgIGNvbnN0IGN0YWdnZXIyID0gbmV3IENoaWxkVGFnZ2VyKHJvb3QsICd0aHJlZScpO1xuXG4gICAgICAvLyBub3QgdGFnZ2FibGUgYXQgYWxsXG4gICAgICBuZXcgQ2hpbGQoY3RhZ2dlciwgJ25vdGFnJyk7XG5cbiAgICAgIGNvbnN0IHRhZyA9IHtrZXk6ICdOYW1lJywgdmFsdWU6ICdUaGVDYWtlSXNBTGllJ307XG4gICAgICBjdGFnZ2VyLnRhZ3Muc2V0VGFnKHRhZy5rZXksIHRhZy52YWx1ZSwge3Byb3BhZ2F0ZTogZmFsc2V9KTtcblxuICAgICAgZm9yIChjb25zdCBjb25zdHJ1Y3Qgb2YgW2N0YWdnZXIxLCBjdGFnZ2VyMl0pIHtcbiAgICAgICAgdGVzdC5kZWVwRXF1YWwoY29uc3RydWN0LnRhZ3MucmVzb2x2ZSgpLCB1bmRlZmluZWQpO1xuICAgICAgfVxuICAgICAgdGVzdC5kZWVwRXF1YWwoY3RhZ2dlci50YWdzLnJlc29sdmUoKVswXS5rZXksICdOYW1lJyk7XG4gICAgICB0ZXN0LmRlZXBFcXVhbChjdGFnZ2VyLnRhZ3MucmVzb2x2ZSgpWzBdLnZhbHVlLCAnVGhlQ2FrZUlzQUxpZScpO1xuICAgICAgdGVzdC5kb25lKCk7XG4gICAgfSxcbiAgICAnc2V0VGFnIHdpdGggb3ZlcndyaXRlIGZhbHNlIGRvZXMgbm90IG92ZXJ3cml0ZSBhIHRhZycodGVzdDogVGVzdCkge1xuICAgICAgY29uc3Qgcm9vdCA9IG5ldyBSb290KCk7XG4gICAgICBjb25zdCBjdGFnZ2VyID0gbmV3IENoaWxkVGFnZ2VyKHJvb3QsICdvbmUnKTtcbiAgICAgIGN0YWdnZXIudGFncy5zZXRUYWcoJ0VudicsICdEZXYnKTtcbiAgICAgIGN0YWdnZXIudGFncy5zZXRUYWcoJ0VudicsICdQcm9kJywge292ZXJ3cml0ZTogZmFsc2V9KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGN0YWdnZXIudGFncy5yZXNvbHZlKCk7XG4gICAgICB0ZXN0LmRlZXBFcXVhbChyZXN1bHQsIFt7a2V5OiAnRW52JywgdmFsdWU6ICdEZXYnfV0pO1xuICAgICAgdGVzdC5kb25lKCk7XG4gICAgfSxcbiAgICAnc2V0VGFnIHdpdGggc3RpY2t5IGZhbHNlIGVuYWJsZXMgcHJvcGFnYXRpb25zIHRvIG92ZXJ3cml0ZSBjaGlsZCB0YWdzJyh0ZXN0OiBUZXN0KSB7XG4gICAgICBjb25zdCByb290ID0gbmV3IFJvb3QoKTtcbiAgICAgIGNvbnN0IGN0YWdnZXIgPSBuZXcgQ2hpbGRUYWdnZXIocm9vdCwgJ29uZScpO1xuICAgICAgY29uc3QgY3RhZ2dlcjEgPSBuZXcgQ2hpbGRUYWdnZXIoY3RhZ2dlciwgJ3R3bycpO1xuICAgICAgY3RhZ2dlci50YWdzLnNldFRhZygnUGFyZW50JywgJ0lzIGFsd2F5cyByaWdodCcpO1xuICAgICAgY3RhZ2dlcjEudGFncy5zZXRUYWcoJ1BhcmVudCcsICdJcyB3cm9uZycsIHtzdGlja3k6IGZhbHNlfSk7XG4gICAgICBjb25zdCBwYXJlbnQgPSBjdGFnZ2VyLnRhZ3MucmVzb2x2ZSgpO1xuICAgICAgY29uc3QgY2hpbGQgPSBjdGFnZ2VyMS50YWdzLnJlc29sdmUoKTtcbiAgICAgIHRlc3QuZGVlcEVxdWFsKHBhcmVudCwgY2hpbGQpO1xuICAgICAgdGVzdC5kb25lKCk7XG5cbiAgICB9LFxuICAgICd0YWdzIHByb3BhZ2F0ZSBmcm9tIGFsbCBwYXJlbnRzJyh0ZXN0OiBUZXN0KSB7XG4gICAgICBjb25zdCByb290ID0gbmV3IFJvb3QoKTtcbiAgICAgIGNvbnN0IGN0YWdnZXIgPSBuZXcgQ2hpbGRUYWdnZXIocm9vdCwgJ29uZScpO1xuICAgICAgbmV3IENoaWxkVGFnZ2VyKGN0YWdnZXIsICd0d28nKTtcbiAgICAgIGNvbnN0IGNOb1RhZyA9IG5ldyBDaGlsZChjdGFnZ2VyLCAndGhyZWUnKTtcbiAgICAgIGNvbnN0IGN0YWdnZXIyID0gbmV3IENoaWxkVGFnZ2VyKGNOb1RhZywgJ2ZvdXInKTtcbiAgICAgIGNvbnN0IHRhZyA9IHtrZXk6ICdOYW1lJywgdmFsdWU6ICdUaGVDYWtlSXNBTGllJ307XG4gICAgICBjdGFnZ2VyLnRhZ3Muc2V0VGFnKHRhZy5rZXksIHRhZy52YWx1ZSwge3Byb3BhZ2F0ZTogdHJ1ZX0pO1xuICAgICAgdGVzdC5kZWVwRXF1YWwoY3RhZ2dlcjIudGFncy5yZXNvbHZlKCksIFt0YWddKTtcbiAgICAgIHRlc3QuZG9uZSgpO1xuICAgIH0sXG4gICAgJ2EgdGFnIGNhbiBiZSByZW1vdmVkIGFuZCBhZGRlZCBiYWNrJyh0ZXN0OiBUZXN0KSB7XG4gICAgICBjb25zdCByb290ID0gbmV3IFJvb3QoKTtcbiAgICAgIGNvbnN0IGN0YWdnZXIgPSBuZXcgQ2hpbGRUYWdnZXIocm9vdCwgJ29uZScpO1xuICAgICAgY29uc3QgdGFnID0ge2tleTogJ05hbWUnLCB2YWx1ZTogJ1RoZUNha2VJc0FMaWUnfTtcbiAgICAgIGN0YWdnZXIudGFncy5zZXRUYWcodGFnLmtleSwgdGFnLnZhbHVlLCB7cHJvcGFnYXRlOiB0cnVlfSk7XG4gICAgICB0ZXN0LmRlZXBFcXVhbChjdGFnZ2VyLnRhZ3MucmVzb2x2ZSgpLCBbdGFnXSk7XG4gICAgICBjdGFnZ2VyLnRhZ3MucmVtb3ZlVGFnKHRhZy5rZXkpO1xuICAgICAgdGVzdC5kZWVwRXF1YWwoY3RhZ2dlci50YWdzLnJlc29sdmUoKSwgdW5kZWZpbmVkKTtcbiAgICAgIGN0YWdnZXIudGFncy5zZXRUYWcodGFnLmtleSwgdGFnLnZhbHVlLCB7cHJvcGFnYXRlOiB0cnVlfSk7XG4gICAgICB0ZXN0LmRlZXBFcXVhbChjdGFnZ2VyLnRhZ3MucmVzb2x2ZSgpLCBbdGFnXSk7XG4gICAgICB0ZXN0LmRvbmUoKTtcbiAgICB9LFxuICAgICdyZW1vdmVUYWcgcmVtb3ZlcyBhIHRhZyBieSBrZXknKHRlc3Q6IFRlc3QpIHtcbiAgICAgIGNvbnN0IHJvb3QgPSBuZXcgUm9vdCgpO1xuICAgICAgY29uc3QgY3RhZ2dlciA9IG5ldyBDaGlsZFRhZ2dlcihyb290LCAnb25lJyk7XG4gICAgICBjb25zdCBjdGFnZ2VyMSA9IG5ldyBDaGlsZFRhZ2dlcihjdGFnZ2VyLCAndHdvJyk7XG4gICAgICBjb25zdCBjdGFnZ2VyMiA9IG5ldyBDaGlsZFRhZ2dlcihyb290LCAndGhyZWUnKTtcblxuICAgICAgLy8gbm90IHRhZ2dhYmxlIGF0IGFsbFxuICAgICAgbmV3IENoaWxkKGN0YWdnZXIsICdub3RhZycpO1xuXG4gICAgICBjb25zdCB0YWcgPSB7a2V5OiAnTmFtZScsIHZhbHVlOiAnVGhlQ2FrZUlzQUxpZSd9O1xuICAgICAgY3RhZ2dlci50YWdzLnNldFRhZyh0YWcua2V5LCB0YWcudmFsdWUpO1xuICAgICAgY3RhZ2dlci50YWdzLnJlbW92ZVRhZygnTmFtZScpO1xuXG4gICAgICBmb3IgKGNvbnN0IGNvbnN0cnVjdCBvZiBbY3RhZ2dlciwgY3RhZ2dlcjEsIGN0YWdnZXIyXSkge1xuICAgICAgICB0ZXN0LmRlZXBFcXVhbChjb25zdHJ1Y3QudGFncy5yZXNvbHZlKCksIHVuZGVmaW5lZCk7XG4gICAgICB9XG4gICAgICB0ZXN0LmRvbmUoKTtcbiAgICB9LFxuICAgICdyZW1vdmVUYWcgd2l0aCBibG9ja1Byb3BhZ2F0ZSByZW1vdmVzIGFueSBwcm9wYWdhdGVkIHRhZ3MnKHRlc3Q6IFRlc3QpIHtcbiAgICAgIGNvbnN0IHJvb3QgPSBuZXcgUm9vdCgpO1xuICAgICAgY29uc3QgY3RhZ2dlciA9IG5ldyBDaGlsZFRhZ2dlcihyb290LCAnb25lJyk7XG4gICAgICBjb25zdCBjdGFnZ2VyMSA9IG5ldyBDaGlsZFRhZ2dlcihjdGFnZ2VyLCAndHdvJyk7XG4gICAgICBjdGFnZ2VyLnRhZ3Muc2V0VGFnKCdFbnYnLCAnRGV2Jyk7XG4gICAgICBjdGFnZ2VyMS50YWdzLnJlbW92ZVRhZygnRW52Jywge2Jsb2NrUHJvcGFnYXRlOiB0cnVlfSk7XG4gICAgICBjb25zdCByZXN1bHQgPSBjdGFnZ2VyLnRhZ3MucmVzb2x2ZSgpO1xuICAgICAgdGVzdC5kZWVwRXF1YWwocmVzdWx0LCBbe2tleTogJ0VudicsIHZhbHVlOiAnRGV2J31dKTtcbiAgICAgIHRlc3QuZGVlcEVxdWFsKGN0YWdnZXIxLnRhZ3MucmVzb2x2ZSgpLCB1bmRlZmluZWQpO1xuICAgICAgdGVzdC5kb25lKCk7XG4gICAgfSxcbiAgICAnY2hpbGRyZW4gY2FuIG92ZXJyaWRlIHBhcmVudCBwcm9wYWdhdGVkIHRhZ3MnKHRlc3Q6IFRlc3QpIHtcbiAgICAgIGNvbnN0IHJvb3QgPSBuZXcgUm9vdCgpO1xuICAgICAgY29uc3QgY3RhZ2dlciA9IG5ldyBDaGlsZFRhZ2dlcihyb290LCAnb25lJyk7XG4gICAgICBjb25zdCBjdGFnQ2hpbGQgPSBuZXcgQ2hpbGRUYWdnZXIoY3RhZ2dlciwgJ29uZScpO1xuICAgICAgY29uc3QgdGFnID0ge2tleTogJ0Jlc3RCZWFjaCcsIHZhbHVlOiAnU3RvbmVTdGVwcyd9O1xuICAgICAgY29uc3QgdGFnMiA9IHtrZXk6ICdCZXN0QmVhY2gnLCB2YWx1ZTogJ2stMzgnfTtcbiAgICAgIGN0YWdnZXIudGFncy5zZXRUYWcodGFnMi5rZXksIHRhZzIudmFsdWUpO1xuICAgICAgY3RhZ2dlci50YWdzLnNldFRhZyh0YWcua2V5LCB0YWcudmFsdWUpO1xuICAgICAgY3RhZ0NoaWxkLnRhZ3Muc2V0VGFnKHRhZzIua2V5LCB0YWcyLnZhbHVlKTtcbiAgICAgIGNvbnN0IHBhcmVudFRhZ3MgPSBjdGFnZ2VyLnRhZ3MucmVzb2x2ZSgpO1xuICAgICAgY29uc3QgY2hpbGRUYWdzID0gY3RhZ0NoaWxkLnRhZ3MucmVzb2x2ZSgpO1xuICAgICAgdGVzdC5kZWVwRXF1YWwocGFyZW50VGFncywgW3RhZ10pO1xuICAgICAgdGVzdC5kZWVwRXF1YWwoY2hpbGRUYWdzLCBbdGFnMl0pO1xuICAgICAgdGVzdC5kb25lKCk7XG4gICAgfSxcbiAgICAncmVzb2x2ZSgpIHJldHVybnMgYWxsIHRhZ3MnKHRlc3Q6IFRlc3QpIHtcbiAgICAgIGNvbnN0IHJvb3QgPSBuZXcgUm9vdCgpO1xuICAgICAgY29uc3QgY3RhZ2dlciA9IG5ldyBDaGlsZFRhZ2dlcihyb290LCAnb25lJyk7XG4gICAgICBjb25zdCBjdGFnQ2hpbGQgPSBuZXcgQ2hpbGRUYWdnZXIoY3RhZ2dlciwgJ29uZScpO1xuICAgICAgY29uc3QgdGFnc05vUHJvcCA9IFtcbiAgICAgICAge2tleTogJ05vcnRoQ291bnR5U3BvdCcsIHZhbHVlOiAnVGFibGV0b3BzJ30sXG4gICAgICAgIHtrZXk6ICdDcm93ZGVkJywgdmFsdWU6ICdUcmVzdGxlcyd9LFxuICAgICAgXTtcbiAgICAgIGNvbnN0IHRhZ3NQcm9wID0gW1xuICAgICAgICB7a2V5OiAnQmVzdEJlYWNoJywgdmFsdWU6ICdTdG9uZVN0ZXBzJ30sXG4gICAgICAgIHtrZXk6ICdCZXN0V2F2ZXMnLCB2YWx1ZTogJ0JsYWNrcyd9LFxuICAgICAgXTtcbiAgICAgIGZvciAoY29uc3QgdGFnIG9mIHRhZ3NOb1Byb3ApIHtcbiAgICAgICAgY3RhZ2dlci50YWdzLnNldFRhZyh0YWcua2V5LCB0YWcudmFsdWUsIHtwcm9wYWdhdGU6IGZhbHNlfSk7XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IHRhZyBvZiB0YWdzUHJvcCkge1xuICAgICAgICBjdGFnZ2VyLnRhZ3Muc2V0VGFnKHRhZy5rZXksIHRhZy52YWx1ZSk7XG4gICAgICB9XG4gICAgICBjb25zdCBhbGxUYWdzID0gdGFnc05vUHJvcC5jb25jYXQodGFnc1Byb3ApO1xuICAgICAgY29uc3QgY0FsbCA9IGN0YWdnZXIudGFncztcbiAgICAgIGNvbnN0IGNQcm9wID0gY3RhZ0NoaWxkLnRhZ3M7XG5cbiAgICAgIGZvciAoY29uc3QgdGFnIG9mIGNBbGwucmVzb2x2ZSgpKSB7XG4gICAgICAgIGNvbnN0IGV4cGVjdGVkVGFnID0gYWxsVGFncy5maWx0ZXIoICh0KSA9PiAodC5rZXkgPT09IHRhZy5rZXkpKTtcbiAgICAgICAgdGVzdC5kZWVwRXF1YWwoZXhwZWN0ZWRUYWdbMF0udmFsdWUsIHRhZy52YWx1ZSk7XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IHRhZyBvZiBjUHJvcC5yZXNvbHZlKCkpIHtcbiAgICAgICAgY29uc3QgZXhwZWN0ZWRUYWcgPSB0YWdzUHJvcC5maWx0ZXIoICh0KSA9PiAodC5rZXkgPT09IHRhZy5rZXkpKTtcbiAgICAgICAgdGVzdC5kZWVwRXF1YWwoZXhwZWN0ZWRUYWdbMF0udmFsdWUsIHRhZy52YWx1ZSk7XG4gICAgICB9XG4gICAgICB0ZXN0LmRvbmUoKTtcbiAgICB9LFxuICB9LFxufTtcbiJdfQ==